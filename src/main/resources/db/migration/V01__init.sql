--V01__init.sql
DROP TABLE IF EXISTS customer_addresses;
DROP TABLE IF EXISTS customers;
DROP TABLE IF EXISTS orders;
DROP TABLE IF EXISTS order_products;
DROP TABLE IF EXISTS products;


CREATE SEQUENCE customer_seq ;
CREATE SEQUENCE customer_address_seq ;
CREATE SEQUENCE product_seq;
CREATE SEQUENCE order_seq ;
CREATE SEQUENCE order_product_seq ;


CREATE TYPE product_status AS ENUM ('AVAILABLE', 'OUT_OF_STOCK', 'DISCONTINUED');


CREATE TABLE CUSTOMERS
(
    customer_id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(100) NOT NULL ,
    phone_number VARCHAR(40),
    email VARCHAR(100) NOT NULL
);



CREATE TABLE  CUSTOMER_ADDRESSES
(
    customer_address_id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    customer_id BIGINT NOT NULL REFERENCES CUSTOMERS(customer_id) ON DELETE CASCADE,
    address VARCHAR(100) NOT NULL
);



CREATE TABLE  PRODUCTS
(
    product_id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    price REAL NOT NULL,
    quantity_in_stock INTEGER NOT NULL,
    status VARCHAR(20) NOT NULL,
    candy_name VARCHAR(100) NOT NULL,
    description TEXT
);

CREATE TABLE ORDERS
(
    order_id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    total_price REAL NOT NULL,
    shipping_charge REAL NOT NULL,
    is_shipped BOOLEAN DEFAULT FALSE,
    shipping_address VARCHAR(100) NOT NULL,
    customer_id BIGINT NOT NULL REFERENCES CUSTOMERS(customer_id) ON DELETE CASCADE
);



CREATE TABLE ORDER_PRODUCTS

(
    order_product_id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    order_id BIGINT NOT NULL REFERENCES ORDERS(order_id) ON DELETE CASCADE,
    product_id BIGINT NOT NULL REFERENCES PRODUCTS(product_id) ON DELETE CASCADE,
    product_quantity INTEGER NOT NULL
);
